<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Environment Check</title>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 4px;
            font-weight: 600;
            margin-left: 10px;
        }
        .status.ok { background: #dcfce7; color: #166534; }
        .status.error { background: #fee2e2; color: #991b1b; }
        code {
            background: #f1f5f9;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.9em;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>Environment Configuration Check</h1>
        <p>This page helps verify that your deployment has the correct environment variables configured.</p>
    </div>

    <div class="card">
        <h2>Supabase Configuration</h2>
        <div id="env-status"></div>
    </div>

    <div class="card">
        <h2>Edge Function Test</h2>
        <div id="function-status">Testing...</div>
    </div>

    <script type="module">
        // This will be replaced by Vite with actual values during build
        const SUPABASE_URL = import.meta.env.VITE_SUPABASE_URL;
        const SUPABASE_ANON_KEY = import.meta.env.VITE_SUPABASE_ANON_KEY;

        const envStatus = document.getElementById('env-status');

        let html = '<ul>';

        if (SUPABASE_URL) {
            html += `<li><strong>VITE_SUPABASE_URL:</strong> <span class="status ok">✓ Set</span><br><code>${SUPABASE_URL}</code></li>`;
        } else {
            html += `<li><strong>VITE_SUPABASE_URL:</strong> <span class="status error">✗ Missing</span></li>`;
        }

        if (SUPABASE_ANON_KEY) {
            const keyPreview = SUPABASE_ANON_KEY.substring(0, 20) + '...' + SUPABASE_ANON_KEY.substring(SUPABASE_ANON_KEY.length - 10);
            html += `<li><strong>VITE_SUPABASE_ANON_KEY:</strong> <span class="status ok">✓ Set</span><br><code>${keyPreview}</code></li>`;
        } else {
            html += `<li><strong>VITE_SUPABASE_ANON_KEY:</strong> <span class="status error">✗ Missing</span></li>`;
        }

        html += '</ul>';

        envStatus.innerHTML = html;

        // Test edge function endpoint
        const functionStatus = document.getElementById('function-status');

        if (SUPABASE_URL && SUPABASE_ANON_KEY) {
            const functionUrl = `${SUPABASE_URL}/functions/v1/send-email`;

            functionStatus.innerHTML = `<p>Testing endpoint: <code>${functionUrl}</code></p><p>⏳ Checking...</p>`;

            fetch(functionUrl, {
                method: 'HEAD',
                headers: {
                    'apikey': SUPABASE_ANON_KEY,
                }
            })
            .then(response => {
                if (response.status === 401) {
                    functionStatus.innerHTML = `<p><span class="status ok">✓ Endpoint is accessible</span></p><p>Status: 401 (Expected - requires authentication)</p><p>✅ Your edge function is deployed and reachable!</p>`;
                } else if (response.status === 404) {
                    functionStatus.innerHTML = `<p><span class="status error">✗ Endpoint returned 404</span></p><p>The send-email function may not be deployed.</p>`;
                } else {
                    functionStatus.innerHTML = `<p><span class="status ok">✓ Endpoint responded</span></p><p>Status: ${response.status}</p>`;
                }
            })
            .catch(error => {
                functionStatus.innerHTML = `<p><span class="status error">✗ Connection failed</span></p><p>${error.message}</p>`;
            });
        } else {
            functionStatus.innerHTML = `<p><span class="status error">✗ Cannot test - environment variables missing</span></p>`;
        }
    </script>
</body>
</html>
